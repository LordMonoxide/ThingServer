plugins {
  id 'java'
}

group = 'weather'
version = '1.0-SNAPSHOT'

repositories {
  mavenCentral()
}

dependencies {
  implementation group: 'io.netty', name: 'netty-all', version: '4.1.107.Final'
  implementation group: 'org.mariadb.jdbc', name: 'mariadb-java-client', version: '3.3.3'

  implementation group: 'org.apache.logging.log4j', name: 'log4j-api', version: '2.14.1'
  implementation group: 'org.apache.logging.log4j', name: 'log4j-core', version: '2.17.1'
  implementation group: 'org.fusesource.jansi', name: 'jansi', version: '2.3.2'

  // To quiet no logger found for netty
  implementation group: 'org.slf4j', name: 'slf4j-nop', version: '2.0.7'
}

jar {
  manifest {
    attributes(
      'Main-Class': 'weather.Server'
    )
  }
}

task clearOutput(type: Delete) {
  delete layout.buildDirectory.dir("libs/libs")
  delete layout.buildDirectory.file("libs/**")
}

task copyLibs(type: Copy) {
  from configurations.compileClasspath + configurations.runtimeClasspath
  into layout.buildDirectory.dir("libs/libs")
}

jar.dependsOn(clearOutput, copyLibs)
